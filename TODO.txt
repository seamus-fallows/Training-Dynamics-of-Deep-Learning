
Proposed Refactor: Push OmegaConf to I/O Boundaries
Current State
OmegaConf's DictConfig is used throughout the codebase. Functions at all layers accept cfg: DictConfig:

run_experiment(cfg: DictConfig, ...)
run_comparative_experiment(cfg: DictConfig, ...)
create_trainer(model_cfg: DictConfig, training_cfg: DictConfig, ...)
Trainer.__init__(self, ..., cfg: DictConfig, ...)
Dataset.__init__(self, cfg: DictConfig, ...)
DeepLinearNetwork.__init__(self, cfg: DictConfig)
Config is saved via OmegaConf.save(cfg, path)

Proposed End State
OmegaConf is used only at I/O boundaries:

Loading: load_config() reads YAML, resolves interpolations, validates, and returns a plain dict
Saving: A helper function converts dict → YAML when saving config with results
Everything else: Works with plain Python dicts

Reasoning

Separation of concerns: Config file format (YAML + interpolation) is an I/O detail, not a runtime concern
Serialization: Plain dicts pickle cleanly across process boundaries; DictConfig can cause issues
Testability: Easier to test functions by passing dicts directly
Reduced coupling: Core training code has no dependency on OmegaConf
Clarity: Config loading becomes a discrete transformation step, not an ambient dependency

Specific Changes Required
1. dln/utils.py:

Modify load_config() to return dict instead of DictConfig:

python  def load_config(...) -> dict:
      ...
      OmegaConf.resolve(cfg)
      validate_config(cfg, config_dir)
      return OmegaConf.to_container(cfg, resolve=True)

Add save_config(cfg: dict, path: Path) helper that converts dict to YAML

2. dln/experiment.py:

Change type hints: cfg: DictConfig → cfg: dict
Replace OmegaConf.save(cfg, ...) with save_config(cfg, ...)
Access config values via cfg["key"] instead of cfg.key

3. dln/factory.py:

Change type hints to dict
Update access patterns

4. dln/train.py (Trainer class):

Change cfg: DictConfig → cfg: dict
Update all cfg.foo → cfg["foo"] access patterns

5. dln/data.py (Dataset class):

Change cfg: DictConfig → cfg: dict
Update access patterns

6. dln/model.py (DeepLinearNetwork class):

Change cfg: DictConfig → cfg: dict
Update access patterns

7. dln/comparative.py:

No changes needed (doesn't access config directly)

8. runner.py:

Should work unchanged (calls load_config and passes result to experiment functions)

9. sweep.py:

Simplifies: no need for OmegaConf.create() conversion since everything already works with dicts

Migration Notes

Changes are mechanical: mostly type hints and cfg.foo → cfg["foo"]
Can use OmegaConf.to_container(cfg, resolve=True) to get dict-like access patterns working immediately
Validation functions in dln/utils.py already use attribute access (cfg.model), will need updating to dict access
Test by running existing experiments and verifying identical outputs

Not in Scope

Changing the YAML config file format itself
Changing the CLI override syntax
Changing the programmatic API signatures beyond type hints